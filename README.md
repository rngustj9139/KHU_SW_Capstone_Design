# AutoEncoder, Two Stage Detector, DeepSORT, ReID, UNet 기반 지능형 교통체계 구축 프로젝트

# 팀명: Guardian of the transportation system
  - 지도 교수: 박제만
  - 팀원:
 소프트웨어융합학과 구현서 2018102091

# 요약
지능형 교통시스템(ITS, Intelligent Transportation Systems)이란 여러 교통 문제들을 효율적으로 해결하기
위해 정보통신기술(ICT)을 적용한 교통 시스템을 의미한다. 본 연구에서는 딥러닝 기술과 대용량 도로
CCTV 데이터를 이용하여 차량 탐지 및 추적, 사고 및 이상 운전 탐지 등의 기능을 구현한 지능형 교통
시스템을 제안한다. 해당 시스템은 UNet 기반의 Semantic Segmentation 모델을 통해 도로 영역의 크기를
정밀하게 측정하고, 이를 FasterRCNN 모델을 통해 탐지된 차량 객체의 수로 나눔으로써 교통 혼잡도
지수(TCI)를 계산한다. 또한 교통 사고나 급발진, 음주운전, 졸음운전에 대한 비정형 데이터 부족 문제를
해결하기 위해 영상 감시분야에서 사용되는 비지도 학습 모델인 AutoEncoder를 도입하여 도로상의 이상
상황을 탐지하고, 예기치 않은 사고 발생 시 교통 관리 당국이 신속하게 대응할 수 있도록 지원한다. 이에
더불어 다양한 기상환경에서 본 프로젝트의 시스템을 적용할 수 있도록 Two Stage Object Detector의 학습
과정에서 다양한 데이터 증강(Data Augmentation) 기법을 적용하였고 이를 통해 모델의 Generalization
Performance를 증가시킬 수 있었다.

# 1.서론
 ## 1.1. 연구배경
  ### 1.1.1. 교통 혼잡 비용 문제
  ![image](https://github.com/rngustj9139/KHU_SW_Capstone_Design/assets/43543906/110bda7d-ff86-4509-aa72-e60f969435ec)
“교통혼잡비용”이란 도로 혼잡으로 인해 발생하는 경제적 손실을 의미한다. 교통혼잡비용에는
교통혼잡에 따른 연료소모, 시간지연, 교통사고, 대기오염 등이 포함되는데, 우리나라의 교통혼잡비용
조사는 한국교통 연구원에서 이루어지고 있으며, 지난 1991년 한국개발연구원(KDI)에서 첫
연구작업이 시작되었다. 대한민국의 연도별 교통혼잡비용은 2022년 약 72조원으로
추정되며(한국교통연구원, 2021.07.02, 보도자료) 매년 약 10%가량 증가하는 추세를 보인다. 이는 한국
명목 GDP의 약 3%가량을 점유하는데 이를 통해 대한민국은 해외 주요 국과 비교했을 때 GDP 대비
교통혼잡비용이 높은 수준인 것을 유추할 수 있다. (텍사스, Urban Mobility, 2019 인릭스 Global Traffic
Scorecard) 교통 혼잡에 대한 비용 문제는 미국과 EU에서도 떠오르고 있다. 2019년 미국 국가 교 통 안전
보드 (NHTSA)는 당해 년도 미국에서 교통 체증으로 인해 약 3억 1,200만 갤런의 연료가 낭비되었 다
밝혔으며, 이를 통해 약 121억 달러의 비용 손실이 발생하였다는 것을 확인할 수 있다. 또한 당해 년도
교통 체증으로 인한 평균 손실 시간은 개인당 약 99시간에 달한다고 분석되었으며, 유럽연합에서는
교통 체 증으로 인한 시간 손실이 GDP의 약 1.0%에 해당하는 경제적 손실을 발생시킨다고 분석하였다.
이러한 높은 교통 혼잡은 긴급차량의 이동 제약을 발생시키며 이로 인해 긴급차량이 사고 현장에
도달하는 데 걸리는 시간을 늦춰 빠른 사고 대응을 방해하는 문제가 발생한다. 
 ### 1.1.2. 도로 혼잡도 측정 방식의 신뢰도 및 안전 문제
 현재 도로의 실시간 혼잡도 계산은 공압식 고무 튜브(매설형 차량 검지기) 및 GPS를 활용하여
이루어지고 있다. 하지만 이러한 방법이 항상 신뢰할 수 있는 것은 아니다. 예를 들어 2020년 베를린에
거주하는 한 예술가는 손수레와 99개의 중고 전화기를 이용해 슈프레 강을 가로지르는 주요 다리 중
하나에서 "가상" 교통 체증을 만들어낸 사례가 존재한다. 이후 Google 지도는 해당 지역을 매우 혼잡한
지역으로 표시하였으며 위와 같은 사례를 제외하고도 도로 혼잡도 추정치를 늘리기 위해 다른 유형의
데이터가 종종 사용된다. 여기에는 과거 패턴, 센서 데이터, 예정된 폐쇄에 대한 지자체 피드 및
사용자가 보고한 사건이 포함되는데, 이를 통해 가장 신뢰할 수 있는 상호 참조 중 하나는 교통
카메라에서 수집된 혼잡도를 실시간으로 시각적으로 인식하는 것임을 알 수 있다. 또한 공압식 고무
튜브 카운터는 쉽고 널리 사용되는 솔루션이지만 아래와 같은 여러 리스크가 존재한다.
![image](https://github.com/rngustj9139/KHU_SW_Capstone_Design/assets/43543906/a8c79ebb-b29e-4fff-83e2-6e935bf0a9b5)


 ### 1.1.3. 도로 CCTV 데이터를 활용한 이상운전(e.g. 음주운전, 졸음운전, 급발진) 탐지 모델의 저조한 등장과 발전
음주운전이나 졸음운전, 급발진 등의 이상운전을 감지하기 위한 모델에 관한 논문은 아래의 예시와
같이 비전기술 및 센서 데이터를 기반으로 하여 다양한 연구 분야에서 다루어지고 있다.
 - "Real-time Detection of Driver Fatigue Using Computer Vision - A Review" (IEEE, 2019)
비전 기반의 기술을 사용하여 운전자의 피로를 실시간으로 감지하는 방법에 대한 논문
 - "Detection of Drunk Driving from Driving Patterns Using Support Vector Machines" (International Journal of Innovative Research in Computer and Communication Engineering, 2016)
Support Vector Machines을 활용하여 운전 패턴에서 음주운전을 감지하는 방법에 대한 논문
 - "Driver Fatigue and Drowsiness Monitoring System Based on Steering Wheel Dynamics" (IEEE Transactions on Intelligent Transportation Systems, 2016)
운전자의 조향 휠 다이내믹스를 기반으로 운전자의 피로와 졸음을 모니터링하는 시스템에 대한 논문
 - "Detection of Aggressive Driving Behavior Using Smartphones: An Exploratory Study" (IEEE Transactions on Intelligent Transportation Systems, 2017)
스마트폰을 사용하여 급발진과 같은 공격적인 운전 행동을 감지하는 방법에 대한 논문
 - "Detection of Drunk Drivers Based on Driving Performance: A Review of Existing Research Methods" (Forensic ScienceInternational, 2016)
운전 성능을 기반으로 음주운전자를 감지하는 기존 연구 방법에 대한 논문

하지만 이상 운전을 식별하기 위한 컴퓨터 비전 모델은 대부분 운전자의 모습을 3인칭으로 촬영하여
얼굴의 특징 점을 분석한 뒤 이상 여부를 예측 하는 기법을 많이 이용하고 있는데, 지능형 CCTV를 통해
차량의 주행 모습을 3인칭으로 확인하여 이상운전을 판단하는 모델은 등장과 발전이 저조한 상태이다.
따라서 위와 같은 이유들로 인해 도로 CCTV 영상 데이터 및 컴퓨터 비전, 특히 딥러닝 기술을 이용한
지능형 교통체계에 대한 필요성이 증대 되어 가고 있는 상황이다

## 1.2. 연구목표
본 연구는 대용량 도로 CCTV 데이터 및 딥러닝 기술을 이용해 지능형 교통 시스템을 구축하고 일반
운전자나 지자체, 정부 유관 부서에게 제공하여 정확한 교통 혼잡도를 추정할 수 있게 함으로써
교통 혼잡도를 줄이는 프로세스에 직∙간접적으로 도움을 주고, 환경 오염 감소 및 신속한 사고
대응을 지원하는 것에 기여하는 것을 목표로 한다. 본 프로젝트의 지능형 교통 시스템은 Two Stage
Detector(FasterRCNN)을 통해 차량 객체를 탐지하고 탐지된 객체의 수를 UNet 기반 Semantic
Segmentation을 통해 도출 된 도로의 면적(Pixel의 개수)으로 나눔으로써 도로 혼잡 지수(TCI)를
계산한다. 본 연구에서 채택한 교통 혼잡 지수 도출 공식은 아래와 같다.

![image](https://github.com/rngustj9139/KHU_SW_Capstone_Design/assets/43543906/64851747-a054-45a3-a10b-cf611c0cade0)

또한 도출 된 교통 혼잡 지수(TCI)는 아래와 같은 기준으로 분류된다.

![image](https://github.com/rngustj9139/KHU_SW_Capstone_Design/assets/43543906/4b62a295-229c-4755-b989-82b7c327ad4e)

이에 더불어 정상 데이터만을 이용해 학습하는 비지도 학습(Unsupervised Learning) 모델인
AutoEncoder를 도입하여 도로상의 이상운전(e.g. 음주운전, 졸음운전, 급발진) 및 교통 사고 여부를
식별하는 기능을 시스템에 추가함으로써 교통 사고 및 이상운전에 대한 데이터 부족 문제를
극복하는 것을 목표로 삼는다. 이상 운전 및 교통 사고 식별에 대한 대부분의 비전 연구에서는
운전자의 안면을 3인칭으로 확인하여 이상 탐지를 수행하지만 본 연구에서는 차량의 주행 모습을
3인칭으로 확인하여 이상 탐지를 수행함으로써 등장과 발전이 저조한 도로 CCTV 데이터 기반 이상
탐지 모델 구축에 선행연구로서 초석을 다질 수 있다.
또한 구축 된 지능형 교통 시스템에 DeepSORT 모델을 적용하여 Multi Object Tracking 기능을
구현하고, 뚜렷하게 구분되지 않는 특징을 갖는 차량 객체에 대해 ReID 모델을 적용 하였을 때와
적용하지 않았을 때의 MOT 성능(MOTA, MOTP) 비교 연구를 수행 할 것이다. 만약 유의미한 성능
향상이 발견될 시 본 연구는 ReID 모델의 잠재성을 증명하고, 범용적인 이용과 발전에 대한 새로운
연구 방향을 제시할 수 있다.

## 1.3. 기대효과
 - 1인 가구 증가와 친환경차 보급 확대 및 소비자의 세컨드 카 수요 등으로 자동차 등록대수가증가하고 있다. 자동 차 등록대수가 증가함에 따라 고속도로에서 정체 구간 안내, 사고 정보 그리고교통량과 같은 교통정보를 분석하여 실시간으로 운전자 및 유관 정부 부서에게 제공하는 것이교통사고를 줄이고, 빠른 사고 대응 처리를 수행할 수 있게 하여 원활한 차량흐름을 만들 수 있다
 
 - 도로교통 CCTV 영상을 통해 도로 위 교통의 흐름을 예측하여 실시간으로 교통 신호를 바꾸거나우회 경로 정보를 제공하여 교통혼잡을 줄일 수 있고, 차량의 종류 및 위치 그리고 속도를 인식하여제한속도위반 또는 전용차로 위반 행위를 검출하여 더욱 안전한 교통체계를 구축하는 데에 기여할 수있다.
 
 - ReID Model을 사용한 DeepSORT Model과 ReID Model을 사용하지 않은 DeepSORT Model 간의 MOT성능 비교 연구를 통해 ReID 모델이 사람과 달리 특징이 명확하게 구분되지 않는 객체를 추적할 때의MOTA, MOTP 성능의 변화를 측정함으로써 ReID Model의 잠재성을 증명하고 범용적인 이용과 발전에대한 새로운 연구 방향을 제시할 수 있다.

 - 많이 알려진 운전자의 모습을 3인칭으로 확인하여 이상운전(e.g. 음주운전 & 졸음운전 & 급발진)을식별하는 모델이 아닌 CCTV를 통해 차량의 주행 모습을 3인칭으로 확인하여 이상운전(e.g. 졸음운전,음주운전, 급발진) 을 판단하는 모델은 등장과 발전이 저조한 상태이다. 따라서 본 프로젝트는 후자의모델을 구축함으로써 해당 분야 프로젝트에 대한 선행연구로서의 초석을 쌓을 수 있으며, 신속한 도로사고 대응 체계를 마련할 발판을 제공한다.

# 2.배경 지식 및 관련 연구
 ## 2.1.1. FasterRCNN (For Object Detection)
 Faster R-CNN(Faster Region-based Convolutional Neural Networks)은 딥러닝을 이용한 객체
검출(object detection) 알고리즘이다 객체 검출은 이미지에서 다양한 객체를 찾아내고 그 위치를
특정하는 작업을 의미하는데, Faster R-CNN은 이러한 객체 검출 문제를 효과적으로 해결하기 위해
개발된 모델로, 특히 높은 정확도를 갖는다는 장점을 가지고 있다. Faster R-CNN의 작동 원리는 다음과
같다.

- 기본 이미지 특징 추출: 먼저, 입력 이미지를 Convolutional Neural Network(CNN)에 통과시켜 기본적인 이미지 특징(Feature Map)을 추출한다. 일반적으로 ResNet, VGG16 등과 같은 사전 학습된 네트워크가 사용된다.
- Region Proposal Network (RPN): 추출된 특징 맵을 이용하여 객체가 있을 가능성이 높은 영역(Region Proposal)을 제안한다. RPN은 CNN의 특징 맵을 입력으로 받아서 객체가 있을 법한 영역들을 추정한다.
- RoI Pooling: 제안된 영역들을 고정된 크기로 변환하여 이후 단계에서 동일한 크기로 처리할 수 있게 한다. 이 단계에서 RoI(Region of Interest) Pooling이 사용된다.
- 객체 분류 및 위치 조정: 변환된 영역들은 Fully Connected Layer를 거쳐지고, 객체의 클래스와 정확한 바운딩박스를 예측할 수 있게 된다.
- 
 ## 2.1.2. DeepSORT (For Multi Object Tracking)
DeepSORT(Deep Simple Online and Realtime Tracking)는 객체 추적 알고리즘 중 하나이며, SORT(Simple
Online and Realtime Tracking)를 개선한 버전으로, 객체 검출 알고리즘과 결합하여 비디오에서
물체를 추적하는 데 사용된다. 특히 사람이나 차량 등의 움직이는 객체를 실시간으로 추적하는 데
강력한 성능을 발휘하는 특징을 갖는다. DeepSORT의 주요 작동 방식은 다음과 같다.

- 객체 검출: 먼저, 각 프레임마다 객체 검출 알고리즘(e.g. YOLO, Faster R-CNN)을 사용하여 현재 프레임에서 객체를 내고 이후 객체의 위치와 크기를 나타내는 바운딩 박스를 얻는다.
- Kalman 필터: 객체의 움직임을 예측하고 추적하는 데 사용된다. 이전 프레임의 정보를 바탕으로 현재 프레임에서의 객체 위치를 예측한다.
- 연관성 매칭: 현재 프레임의 검출 결과와 이전 프레임의 추적 결과를 연결한다. 이를 위해 Hungarian 알고리즘을 사용하여 가장 적합한 매칭을 찾는다.
- 재식별 정보 사용(ReID): DeepSORT는 객체의 시각적 특징을 활용하여 동일 객체를 식별한다. 이를 통해 객체가 일시적으로 검출되지 않더라도 지속적으로 추적할 수 있다
- 
DeepSORT는 SORT의 단순한 칼만 필터와 Hungarian 알고리즘을 기반으로 하되, 추가적으로 객체의
시각적 특징을 고려하여 더욱 정확한 추적을 가능하게 하는데, 이러한 이유로 자율 주행, 영상 감시
시스템, 스포츠 분석 등 다양한 분야에서 많이 활용되고 있다.

 ## 2.1.3. AutoEncoder (For Anomaly Detection)
 AutoEncoder는 인공 신경망의 일종으로, 주로 데이터의 차원 축소와 특징 추출을 위해 사용된다.
AutoEncoder는 입력 데이터를 압축된 저차원 표현으로 변환한 후, 이를 다시 원래 데이터로 복원하는
과정을 통해 학습하는데, 이러한 과정에서 데이터의 중요한 특징을 추출할 수 있다. AutoEncoder의
기본 구성 요소는 다음과 같다.

- 인코더(Encoder): 입력 데이터를 저차원 잠재 공간(latent space)으로 변환한다. 인코더는 여러 개의 신경망 층으로 구성될 수 있으며, 입력 데이터의 중요한 특징을 압축하여 잠재 벡터(latent vector)로 표현한다.
- 디코더(Decoder): 잠재 벡터를 다시 원래의 데이터 형태로 복원한다. 디코더는 인코더의 반대 과정으로, 잠재 벡터를 입력으로 받아 원래의 데이터와 유사한 출력을 생성한다.

AutoEncoder의 학습 과정은 입력 데이터를 다시 출력으로 복원하는 동안 손실 함수(loss function)를
최소화하는 방향으로 이루어진다. 손실 함수는 일반적으로 입력 데이터와 출력 데이터 간의 차이를
측정하는 재구성 오류(reconstruction error)를 사용한다.


 ## 2.1.4. UNet (For Segmentation)
U-Net은 주로 이미지 분할 작업에 사용되는 딥러닝 모델이다. U-Net은 이미지의 각 픽셀이 특정 클래스에
속하는지 여부를 예측하여 이미지를 분할하는 데 특화되어 있으며, 이름에서 알 수 있듯이 U-Net은 U자
형태의 네트워크 구조를 가지고 있다. U-Net의 주요 특징과 구조는 다음과 같다.

-  인코딩 경로(Contracting Path):
  -- ㅇㅇ
- 디코딩 경로(Expanding Path):
- 스킵 연결(Skip Connections):



  
